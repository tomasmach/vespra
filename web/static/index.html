<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mnemon-bot Dashboard</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="sidebar-logo">
        <span class="logo-icon">ðŸ§ </span>
        <span class="logo-text">Mnemon</span>
      </div>
      <nav class="sidebar-nav">
        <button class="nav-item active" id="nav-config" onclick="showView('config')">
          <span class="nav-icon">âš™</span> Config
        </button>
        <button class="nav-item" id="nav-agents" onclick="showView('agents')">
          <span class="nav-icon">ðŸ¤–</span> Agents
        </button>
        <button class="nav-item" id="nav-memories" onclick="showView('memories')">
          <span class="nav-icon">ðŸ—„</span> Memories
        </button>
        <button class="nav-item" id="nav-monitor" onclick="showView('monitor')">
          <span class="nav-icon">ðŸ“¡</span> Monitor
        </button>
      </nav>
      <div class="sidebar-footer">
        <span id="sse-dot" class="sse-dot"></span>
        <span id="sse-label" class="sse-label">Connectingâ€¦</span>
      </div>
    </aside>

    <main class="main-content">
      <!-- Config view -->
      <div id="view-config" class="view">
        <div class="card">
          <div class="card-header">
            <h2>Configuration</h2>
            <button class="btn-primary" onclick="saveConfig()">Save</button>
          </div>
          <textarea id="config-editor" spellcheck="false"></textarea>
          <span id="config-status" class="status-msg"></span>
        </div>
      </div>

      <!-- Agents view -->
      <div id="view-agents" class="view" hidden>
        <div class="card">
          <div class="card-header">
            <h2>Agents</h2>
            <button class="btn-primary" onclick="openNewAgentForm()">+ New Agent</button>
          </div>
          <div id="agents-list"></div>
          <span id="agents-status" class="status-msg"></span>
        </div>

        <!-- New / Edit agent form (hidden by default) -->
        <div id="agent-form-card" class="card" hidden>
          <div class="card-header">
            <h2 id="agent-form-title">New Agent</h2>
          </div>
          <div class="form-grid">
            <label>ID (unique name)</label>
            <input id="af-id" type="text" placeholder="my-server">
            <label>Server ID (Discord guild ID)</label>
            <input id="af-server-id" type="text" placeholder="123456789">
            <label>Token (optional, overrides default)</label>
            <input id="af-token" type="password" placeholder="Leave blank to use default bot token">
            <label>Soul File (optional)</label>
            <input id="af-soul-file" type="text" placeholder="~/.config/mnemon-bot/soul.txt">
            <label>DB Path (optional, auto-derived if blank)</label>
            <input id="af-db-path" type="text" placeholder="auto">
            <label>Response Mode (optional)</label>
            <select id="af-response-mode">
              <option value="">inherit from global</option>
              <option value="smart">smart</option>
              <option value="mention">mention</option>
              <option value="all">all</option>
              <option value="none">none</option>
            </select>
          </div>
          <div class="modal-actions">
            <button class="btn-secondary" onclick="closeAgentForm()">Cancel</button>
            <button class="btn-primary" onclick="saveAgent()">Save</button>
          </div>
        </div>
      </div>

      <!-- Memories view -->
      <div id="view-memories" class="view" hidden>
        <div class="card">
          <div class="search-row">
            <select id="mem-agent-select" onchange="onMemAgentChange()">
              <option value="">â€” select agent â€”</option>
            </select>
            <input id="mem-server" type="text" placeholder="Server ID (manual)">
            <input id="mem-user" type="text" placeholder="User ID (optional)">
            <input id="mem-query" type="text" placeholder="Search (optional)">
            <button class="btn-primary" onclick="loadMemories()">Search</button>
          </div>
          <span id="mem-status" class="status-msg"></span>
        </div>
        <span id="mem-count" class="result-count" hidden></span>
        <div id="mem-grid" class="card-grid"></div>
      </div>

      <!-- Monitor view -->
      <div id="view-monitor" class="view" hidden>
        <div class="monitor-header">
          <span id="agent-count-dot" class="status-dot"></span>
          <span id="monitor-status">Waiting for dataâ€¦</span>
        </div>
        <div id="agent-grid" class="card-grid"></div>
      </div>
    </main>
  </div>

  <!-- Edit modal -->
  <dialog id="edit-modal">
    <div class="modal-content">
      <h3>Edit Memory</h3>
      <textarea id="edit-textarea"></textarea>
      <div class="modal-actions">
        <button class="btn-secondary" onclick="closeEditModal()">Cancel</button>
        <button class="btn-primary" onclick="confirmEdit()">Save</button>
      </div>
    </div>
  </dialog>

  <script src="/static/app.js"></script>
</body>
</html>
