<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mnemon-bot Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400&family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <header class="top-bar">
    <div class="top-bar-brand">
      <span class="logo-icon">ðŸ§ </span>
      <span class="logo-text">Mnemon</span>
    </div>
    <div class="top-bar-right">
      <span id="sse-dot" class="sse-dot"></span>
      <span id="sse-label" class="sse-label">Connectingâ€¦</span>
      <button class="btn-monitor" onclick="toggleMonitor()">Monitor</button>
    </div>
  </header>

  <div class="layout">
    <aside class="agent-sidebar">
      <div class="sidebar-agents-label">Agents</div>
      <div id="agent-sidebar-list" class="agent-sidebar-list"></div>
      <div class="sidebar-footer">
        <button class="btn-settings" id="btn-settings">âš™ Settings</button>
        <button class="btn-new-agent" id="btn-new-agent">+ New Agent</button>
      </div>
    </aside>

    <main class="detail-panel">
      <!-- No agent selected -->
      <div id="panel-empty" class="panel-empty">
        <p>Select an agent from the sidebar, or create a new one.</p>
      </div>

      <!-- Global config editor -->
      <div id="panel-config" class="panel-section" hidden>
        <div class="panel-header">
          <h2>Global Config</h2>
        </div>
        <div class="detail-content">
          <div id="config-path-info" class="soul-path-info"></div>
          <textarea id="config-editor" spellcheck="false"></textarea>
          <div class="form-actions">
            <button class="btn-primary" id="btn-save-config">Save Config</button>
          </div>
          <span id="config-status" class="status-msg"></span>
        </div>
      </div>

      <!-- New agent form -->
      <div id="panel-new-agent" class="panel-section" hidden>
        <div class="panel-header">
          <h2>New Agent</h2>
        </div>
        <div class="detail-content">
          <div class="form-grid">
            <label>ID (unique name)</label>
            <input id="na-id" type="text" placeholder="my-server">
            <label>Server ID (Discord guild ID)</label>
            <input id="na-server-id" type="text" placeholder="123456789">
            <label>Token (optional)</label>
            <input id="na-token" type="password" placeholder="Leave blank to use default bot token">
            <label>Soul File (optional)</label>
            <input id="na-soul-file" type="text" placeholder="~/.config/mnemon-bot/soul.txt">
            <label>DB Path (optional)</label>
            <input id="na-db-path" type="text" placeholder="auto">
            <label>Response Mode</label>
            <select id="na-response-mode">
              <option value="">inherit from global</option>
              <option value="smart">smart</option>
              <option value="mention">mention</option>
              <option value="all">all</option>
              <option value="none">none</option>
            </select>
          </div>
          <div class="form-actions">
            <button class="btn-secondary" onclick="cancelNewAgent()">Cancel</button>
            <button class="btn-primary" onclick="createAgent()">Create Agent</button>
          </div>
          <span id="new-agent-status" class="status-msg"></span>
        </div>
      </div>

      <!-- Agent detail -->
      <div id="panel-agent" class="panel-section" hidden>
        <div class="panel-header">
          <h2 id="agent-detail-name"></h2>
          <button class="btn-danger" onclick="deleteSelectedAgent()">Delete</button>
        </div>
        <div class="detail-tabs">
          <button class="detail-tab active" id="dtab-config" onclick="showDetailTab('config')">Config</button>
          <button class="detail-tab" id="dtab-soul" onclick="showDetailTab('soul')">Soul</button>
          <button class="detail-tab" id="dtab-memories" onclick="showDetailTab('memories')">Memories</button>
        </div>

        <!-- Config tab -->
        <div id="detail-config" class="detail-content">
          <div class="form-grid">
            <label>Server ID (Discord guild ID)</label>
            <input id="cfg-server-id" type="text">
            <label>Token (optional)</label>
            <input id="cfg-token" type="password" placeholder="Leave blank to keep existing token">
            <label>Soul File (optional)</label>
            <input id="cfg-soul-file" type="text" placeholder="~/.config/mnemon-bot/soul.txt">
            <label>DB Path (optional)</label>
            <input id="cfg-db-path" type="text" placeholder="auto">
            <label>Response Mode</label>
            <select id="cfg-response-mode">
              <option value="">inherit from global</option>
              <option value="smart">smart</option>
              <option value="mention">mention</option>
              <option value="all">all</option>
              <option value="none">none</option>
            </select>
          </div>
          <div class="form-actions">
            <button class="btn-primary" onclick="saveAgentConfig()">Save Config</button>
          </div>
          <span id="cfg-status" class="status-msg"></span>
        </div>

        <!-- Soul tab -->
        <div id="detail-soul" class="detail-content" hidden>
          <div id="soul-path-info" class="soul-path-info"></div>
          <textarea id="soul-editor" spellcheck="false"></textarea>
          <div class="form-actions">
            <button class="btn-primary" onclick="saveSoul()">Save Soul</button>
          </div>
          <span id="soul-status" class="status-msg"></span>
        </div>

        <!-- Memories tab -->
        <div id="detail-memories" class="detail-content" hidden>
          <div class="search-row">
            <input id="mem-user" type="text" placeholder="User ID (optional)">
            <input id="mem-query" type="text" placeholder="Search (optional)">
            <button class="btn-primary" onclick="searchMemories()">Search</button>
          </div>
          <span id="mem-status" class="status-msg"></span>
          <span id="mem-count" class="result-count" hidden></span>
          <div id="mem-grid" class="card-grid"></div>
        </div>
      </div>
    </main>
  </div>

  <!-- Monitor overlay -->
  <div id="monitor-overlay" class="monitor-overlay" hidden>
    <div class="monitor-panel">
      <div class="monitor-panel-header">
        <div class="monitor-panel-title">
          <span id="agent-count-dot" class="status-dot"></span>
          <span id="monitor-status">Waiting for dataâ€¦</span>
        </div>
        <button class="btn-icon" onclick="toggleMonitor()">âœ•</button>
      </div>
      <div class="monitor-panel-content">
        <div id="agent-grid" class="card-grid"></div>
      </div>
    </div>
  </div>

  <!-- Edit modal -->
  <dialog id="edit-modal">
    <div class="modal-content">
      <h3>Edit Memory</h3>
      <textarea id="edit-textarea"></textarea>
      <div class="modal-actions">
        <button class="btn-secondary" onclick="closeEditModal()">Cancel</button>
        <button class="btn-primary" onclick="confirmEdit()">Save</button>
      </div>
    </div>
  </dialog>

  <script src="/static/app.js"></script>
</body>
</html>
